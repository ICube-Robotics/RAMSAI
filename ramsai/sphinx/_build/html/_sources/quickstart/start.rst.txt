======================================================
Start robot configuration, path planning and execution
======================================================

.. contents:: What is on this page ?
        :depth: 2
        :local:
        :backlinks: top

It is possible to work in both :ref:`simulation-label` and :ref:`real-label` modes with the robot. The two operating modes are shown below.

.. _simulation-label: 

----------
Simulation 
----------

In the launch file ``ramsai.launch.py`` of the ramsai_bringup package, make sure that the 'use_fake_hardware' argument is set to "true". 

.. code-block:: console

    declared_arguments.append(
        DeclareLaunchArgument(
            'use_fake_hardware',
            default_value='true',
            description='Start robot with fake hardware mirroring command to its states.',
        )
    )

.. raw:: html

   <span style="font-size: smaller;">All information about file ramsai.launch.py you will find here (LINK DOCUMENTATION FILE)</span>


Launch robot configuration
==========================

After sourcing the environment with the command line :

.. code-block:: console    

    $ source install/setup.bash

You can launch the robot configuration with MoveIt and display it in RViz with this command line:

.. code-block:: console    

    $ ros2 launch ramsai_bringup ramsai.launch.py 

An RViz environment will open in another window, with the robot in its initial position.
At this point, it is possible to visualize and move the robot in RViz with Move-it by checking the "Motion planning" box. If you want the robot to follow a trajectory, select the OMPL planner in the "Plan" tab.


Launch the trajectory in ROS2 with Moveit
=========================================

Before launching a trajectory, check that you have a *.apt* or *.csv* file describing all the points to be traversed according to the instructions given in (LINK TO TRAJECTOIRE FILE EXPLANATION) located in the ``/ramsai_planning/config/example_apt or /ramsai_planning/config/example.csv`` folder.

It is also necessary to modify the path planning configuration file ``ramsai_planning/config/robot_cartesian_config.yaml``. 


.. code-block:: console    

    /**:
    ros__parameters:
        waypoint_file_type: "<apt ou csv>"
        waypoint_file_path: "<path>/ramsai_planning/config/example_apt/<your_file_name>.apt"
        shift: [<x_shift>, <y_shift>, <z_shift>]
        scale: <metric_scale>
        velcocity_scaling: <velcocity_scaling>
        acceleration_scaling: <acceleration_scaling>
        plot_waypoints: <true or false>
        plot_frames: <true or false>


.. raw:: html

   <span style="font-size: smaller;">All information about robot_cartesian_config.yaml you find here (LINK DOCUMENTATION FILE).</span>


All parameters must be filled in:
    - Give the path file extension ``waypoint_file_type``.
    - Give access to this file in the .yaml file ``waypoint_file_path``.
    - Give the offset vector of each point relative to the origin of the R0 reference frame (robot base) ``shift``
    - Give the unit for converting data into metric ``scale``
    - Give the speed factor: ``velcocity_scaling``
    - Give the acceleration factor: ``acceleration_scaling``
    - Set true if you want to plot trajectory points in RViz ``plot_waypoints``
    - Set true if you want the nozzle markers to appear at each point ``plot_frames``




Once all these conditions have been met, the trajectory given in the file can be launched with the OMPL planner using the command: 

.. code-block:: console    

    $ ros2 launch ramsai_planning robot_cartesian_ompl.launch.py


.. raw:: html

   <span style="font-size: smaller;">All information about robot_cartesian_ompl.launch.py you find here (LINK DOCUMENTATION FILE).</span>

    

or with the PILZ planner:  

.. code-block:: console    

    $ ros2 launch ramsai_planning robot_cartesian_pilz.launch.py


.. raw:: html

   <span style="font-size: smaller;">All information about robot_cartesian_pilz.launch.py you find here (LINK DOCUMENTATION FILE). </span>


.. _reel-label:

----


----
Real
----